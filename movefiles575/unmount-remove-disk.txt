
#################################################################
#@  
#@   stop disk activity and unmount/remove disks from disk dock.
#@  
####################################   2026-02-17[Feb-Tue]09-09AM 

Copy/paste the following to terminal.


Answer:


1a.  

# check activity beforehand..

sudo ls
#
df -h
sudo netstat -tnpa | grep ':22'
ps -ef |grep rclo
sudo iptables -L INPUT -n --line-numbers;

#  sudo apt install sysstat
iostat -xz 3


1b.

echo "Blocking incoming data..."

pkill rclone

sudo iptables -L INPUT -n --line-numbers;
# sudo iptables -A INPUT -p tcp --dport 22 -j REJECT ; date ;
# OR
# stop ssh for n seconds in background ..
( sudo iptables -A INPUT -p tcp --dport 22 -j REJECT; sleep 260; sudo iptables -D INPUT -p tcp --dport 22 -j REJECT ) &
 jobs -l
sudo iptables -L INPUT -n --line-numbers;


2.
```

# check firewall block and unmount.

#!/bin/bash
#
# check it..
sudo iptables -L INPUT -n --line-numbers;
sudo iptables-nft -L INPUT --line-numbers;
sudo iptables-legacy -L INPUT --line-numbers -n -v;
ps -ef |grep rclon;
#
echo "Killing active transfer processes..."
sudo pkill -u albe rclone
echo "Flushing disk cache (be patient)..."
sync
echo "Unmounting disk... [below is not nvme's so should be safe..]"
#  ---------  check these devices calls...... 
sudo umount -l /dev/sdb
sudo umount -l /dev/sda
#
echo "Powering down drive..."
sudo udisksctl power-off -b /dev/sdc
df -h
echo "Check that it is unmounted to see if it is Safe to remove disk now."

```


3. 
remove the disks.



4.
To Re-enable SSH
```

# use legacy rules to avoid confusion.
#Your system has:
#iptables-legacy (real rules)
#iptables-nft (wrapper that translates to nftables)
#iptables symlinked to iptables-nft
sudo update-alternatives --set iptables /usr/sbin/iptables-legacy
sudo update-alternatives --set ip6tables /usr/sbin/ip6tables-legacy

sudo iptables -D INPUT -p tcp --dport 22 -j REJECT
# check it..
sudo iptables -L INPUT -n --line-numbers;
sudo iptables-legacy -L INPUT --line-numbers -n -v;
sudo iptables-nft -L INPUT --line-numbers;

```





~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


-----

Question:

I have dozens of machines running this. how to stop the data flow on target `dockvi641ssh` pc so the target 20tb disk can be unmounted gracefully. I have gotten disk errors and not able to mount the 20tb disk in some cases. I want to avoid those disk errors.
I want to stop the flow at the target machine as it is not practical to do it at dozens of source machines.

```
Example issues:
-The "Disk Identifier" is all zeros: In your fdisk output, the Disk Identifier is 00000000-0000-0000-0000-000000000000. For a GPT disk, this should be a unique hex string. Seeing all zeros usually means the Partition Table header is corrupted or wasn't written correctly when you "renamed" it.
-Partition 12 at Sector 2048: It is very unusual for a disk to have only one partition and for it to be numbered 12 while starting at the very beginning of the disk (sector 2048). This often happens when a high-capacity drive dock (like your ASM1352R) tries to use a proprietary mapping or when a "Move/Resize" operation was interrupted.
-GNOME Disks says "Unknown": The orange bar in your image shows "Unknown" because the OS can see the partition entry, but it can no longer find the "magic bytes" that identify it as ext4 at the expected location.
```
Conjecture:
The errors like (Disk Identifier: 0000 and corrupted superblocks) may happen because:
An SSH process is still "writing" to the buffer.
You pull the disk.
The GPT header (at the very beginning/end of the disk) was in the middle of an update or held in the dock's volatile cache.
By stopping SSH first, you ensure the source of the data is gone. By running sync, you ensure the data moves from RAM to the dock. By running udisksctl power-off, you ensure the dock moves the data to the platters.
```
Script:
rclone move --min-age=${minage}d  --max-age=999d  --order-by modtime,ascending  -v ${srcdir} \
dock-vi641-ssh:/media/albe/vi641-9641/mcdata/${HOSTNAME}  --log-file=$logf 
```



------------
